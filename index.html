<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å-‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 min-h-screen">

<div class="max-w-5xl mx-auto p-6">
  <!-- Header with Logo -->
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-3">
      <img src="https://upload.wikimedia.org/wikipedia/commons/5/5b/QIAGEN_Logo.svg" alt="QIAGEN Logo" class="h-10" />
      <span class="text-slate-500 text-sm">QIAGEN</span>
    </div>
    <div class="text-right text-slate-400 text-sm">Spare Parts System</div>
  </div>
  <!-- Status Bar -->
  <div id="statusBar" class="hidden mb-4 p-3 rounded flex justify-between text-white">
    <span id="statusUser"></span>
    <span id="statusAction"></span>
    <span id="statusTime"></span>
  </div>
  <h1 class="text-3xl font-bold mb-2 text-center">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å-‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</h1>
<p class="text-center text-slate-600 mb-6 text-lg">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
  <div id="userPage" class="bg-slate-100 min-h-screen flex flex-col items-center justify-center">
  <div class="bg-white border-2 border-slate-300 rounded-2xl shadow-xl p-8 max-w-5xl w-full">
    <h1 class="text-3xl font-bold text-center mb-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h1>
    <p class="text-center text-slate-500 mb-8">Please select user</p>

    <div class="grid grid-cols-3 grid-rows-2 gap-6">
      <div class="user-card"><button onclick="selectUser('KM',this)" class="user-btn"><span class="icon">üë§</span> KM</button></div>
      <div class="user-card"><button onclick="selectUser('TK',this)" class="user-btn"><span class="icon">üë§</span> TK</button></div>
      <div class="user-card"><button onclick="selectUser('PST',this)" class="user-btn"><span class="icon">üë§</span> PST</button></div>
      <div class="user-card"><button onclick="selectUser('PSO',this)" class="user-btn"><span class="icon">üë§</span> PSO</button></div>
      <div class="user-card"><button onclick="selectUser('PK',this)" class="user-btn"><span class="icon">üë§</span> PK</button></div>
      <div class="user-card"><button onclick="selectUser('PA',this)" class="user-btn"><span class="icon">üë§</span> PA</button></div>
    </div>
  </div>
</div>
    <button onclick="selectUser('TK',this)" class="user-btn"><span class="icon">üë§</span> TK</button></div>
    <button onclick="selectUser('PST',this)" class="user-btn"><span class="icon">üë§</span> PST</button></div>
    <button onclick="selectUser('PSO',this)" class="user-btn"><span class="icon">üë§</span> PSO</button></div>
    <button onclick="selectUser('PK',this)" class="user-btn"><span class="icon">üë§</span> PK</button></div>
    <button onclick="selectUser('PA',this)" class="user-btn"><span class="icon">üë§</span> PA</button></div>
  </div>

  <!-- ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô -->
  <div id="menuPage" class="hidden text-center bg-white border-2 border-slate-300 rounded-xl shadow-md p-6">
    <p class="mb-6 text-lg">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <span id="currentUser" class="font-semibold"></span></p>
    <div class="flex justify-center gap-6">
      <button onclick="openIssue()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-6 rounded-xl text-xl">‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</button>
      <button onclick="openReturn()" class="bg-green-600 hover:bg-green-700 text-white px-8 py-6 rounded-xl text-xl">‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</button>
    </div>
  </div>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ö‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô -->
  <div id="actionPage" class="hidden">
    <h2 id="actionTitle" class="text-xl font-semibold mb-4"></h2>
    <div class="flex gap-2 mb-4">
      <input id="search" type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Material" class="flex-1 px-3 py-2 rounded border" />
      <button onclick="searchMaterial()" class="btn">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button></div>
    </div>

    <div class="overflow-x-auto">
      <table id="resultTable" class="hidden w-full bg-white rounded shadow">
        <thead class="bg-slate-200">
          <tr>
            <th class="th">A</th>
            <th class="th">B</th>
            <th class="th">C</th>
            <th class="th">H</th><th class="th">Stock</th>
            <th class="th">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            <th class="th">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <button onclick="backMenu()" class="mt-4 text-slate-600 underline">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button></div>
  </div>
</div>

<script>
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQg2ma13Gm9ppdtEaZAb9fLuZn2YmoXFJx3DYb5te4Fua4xej_OFU-_6J6OQBXXdO8AAWlueRQ1omHd/pub?output=csv';
const scriptUrl = 'PUT_YOUR_APPS_SCRIPT_WEBAPP_URL_HERE';
let csvData = [];
let currentUser = '';
let currentAction = '';

fetch(csvUrl)
  .then(res => res.text())
  .then(text => {
    const rows = text.split('
').map(r => r.split(','));
    csvData = rows.slice(1);
  });

function selectUser(u,btn) {
  document.querySelectorAll('.user-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  currentUser = u;
  document.getElementById('currentUser').innerText = u;
  userPage.classList.add('hidden');
  menuPage.classList.remove('hidden');
}

function openIssue() { openAction('‡πÄ‡∏ö‡∏¥‡∏Å','blue'); }
function openReturn() { openAction('‡∏Ñ‡∏∑‡∏ô','green'); }

function openAction(type,color) {
  currentAction = type;
  menuPage.classList.add('hidden');
  actionPage.classList.remove('hidden');
  actionTitle.innerText = type + '‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà';
  actionTitle.className = `text-xl font-semibold mb-4 text-${color}-600`;

  statusBar.className = `mb-4 p-3 rounded flex justify-between text-white bg-${color}-600`;
  statusBar.classList.remove('hidden');
  statusUser.innerText = '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ' + currentUser;
  statusAction.innerText = '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ' + type;
  statusTime.innerText = new Date().toLocaleString();
}

}

function backMenu() {
  actionPage.classList.add('hidden');
  menuPage.classList.remove('hidden');
}

function searchMaterial() {
  const q = search.value.toLowerCase();
  const tbody = document.querySelector('#resultTable tbody');
  tbody.innerHTML = '';

  csvData.filter(r => r[0]?.toLowerCase().includes(q)).forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="td">${r[0]}</td>
      <td class="td">${r[1]}</td>
      <td class="td">${r[2]}</td>
      <td class="td">${r[7]}</td><td class="td stock">${r[8] || 0}</td>
      <td class="td"><input type="number" min="1" class="w-20 border rounded px-2 py-1" max="${r[8] || 0}" /></td>
      <td class="td"><button class="btn" onclick="confirmAction(this,'${r[0]}')">‡∏ï‡∏Å‡∏•‡∏á</button></div></td>
    `;
    tbody.appendChild(tr);
  });

  resultTable.classList.remove('hidden');
}

function confirmAction(btn, material) {
  const row = btn.closest('tr');
  const stock = parseInt(row.querySelector('.stock').innerText);
  const qty = parseInt(row.querySelector('input').value);
  if (!qty) return showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô','red');
  if (currentAction === '‡πÄ‡∏ö‡∏¥‡∏Å' && qty > stock) return showToast('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô Stock','red');

  fetch(scriptUrl, {
    method: 'POST',
    body: JSON.stringify({
      user: currentUser,
      action: currentAction,
      material: material,
      qty: qty,
      time: new Date().toISOString()
    })
  })
  .then(() => showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', currentAction === '‡πÄ‡∏ö‡∏¥‡∏Å' ? 'blue' : 'green'))
  .catch(() => showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î','red'));
}(() => alert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'));
}
</script>

<style>
.btn { @apply bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition; }
.th { @apply px-3 py-2 text-left; }
.td { @apply px-3 py-2 border-t; }
.user-card { @apply border-2 border-slate-300 rounded-xl p-2 bg-slate-50 hover:shadow-lg transition; }
.user-card .user-btn { @apply w-full flex items-center justify-center gap-2 bg-white text-lg font-semibold py-6 rounded-lg hover:bg-blue-50 transition; }
.user-card .user-btn.active { @apply bg-blue-600 text-white scale-105; }
.icon { @apply text-2xl; }
</style>

</body>
</html>
