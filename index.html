
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å CSV)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --pri:#0078d4; --bg:#f7f7fb; --border:#e1e1e8; --text:#222; }
    *{box-sizing:border-box}
    body { font-family: system-ui,Segoe UI,Roboto,Arial,sans-serif; margin:0; color:var(--text); background:var(--bg);}
    header { background:#fff; border-bottom:1px solid var(--border); padding:16px 20px; display:flex; justify-content:space-between; align-items:center;}
    header h1 { margin:0; font-size:18px;}
    .user-badge { font-size:13px; color:#333; cursor:pointer; }
    .user-badge .chip { display:inline-block; padding:4px 10px; border-radius:999px; border:1px solid var(--border); background:#fff; margin-left:6px; }

    .container { max-width:1100px; margin: 20px auto; background:#fff; border:1px solid var(--border); border-radius:10px; padding:20px;}
    .home { text-align:center; padding:60px 20px;}
    .btn { display:inline-block; padding:12px 18px; border-radius:8px; border:1px solid var(--pri); color:#fff; background:var(--pri); cursor:pointer; text-decoration:none; }
    .btn.ghost { background:#fff; color:var(--pri); }
    .btn.warn { background:#b30000; border-color:#b30000; }
    .btn.small { padding:8px 12px; font-size:14px; }
    .btn + .btn { margin-left:12px; }
    .row { display:flex; gap:16px; flex-wrap:wrap; }
    .col-6 { flex:1 1 300px; }
    label { display:block; margin-top:12px; font-weight:600; }
    input, select, textarea { width:100%; padding:10px; margin-top:6px; border:1px solid var(--border); border-radius:6px; background:#fff; }
    textarea { resize:vertical; }
    h2 { margin:0 0 6px 0;}
    .muted { color:#666; font-size:13px; }
    table { width:100%; border-collapse:collapse; margin-top:16px; }
    th, td { border:1px solid var(--border); padding:10px; vertical-align:top;}
    th { background:#fafafa; text-align:left;}
    .actions { display:flex; gap:8px; margin-top:16px; flex-wrap:wrap; }
    .toolbar { display:flex; justify-content:space-between; align-items:center; margin-top:6px;}
    .backlink { color:var(--pri); cursor:pointer; text-decoration:none; }
    .chip { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); background:#fff; color:#333; }
    .section { margin-top:10px; padding-top:10px; border-top:1px dashed var(--border); }
    .hidden { display:none; }
    .footer-note { color:#666; font-size:12px; margin-top:10px; }

    /* Overlay ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ */
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      display:flex; align-items:center; justify-content:center; z-index: 1000; }
    .overlay-card {
      width: min(560px, 92vw);
      background: #fff; border-radius: 12px; border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      padding: 20px;
      text-align:center;
    }
    .user-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; margin-top:16px; }
    .user-btn {
      padding:14px 10px; border-radius:10px; border:1px solid var(--border);
      background:#fff; cursor:pointer; font-weight:700; font-size:16px;
    }
    .user-btn:hover { border-color: var(--pri); color: var(--pri); }

    /* Modal ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Material */
    .modal { position: fixed; inset:0; display:none; align-items: center; justify-content: center; z-index: 1100;
      background: rgba(0,0,0,0.4); }
    .modal .card { width: min(1000px, 95vw); background:#fff; border:1px solid var(--border); border-radius:12px; padding:16px;
      max-height: 90vh; overflow:auto; }
    .modal .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .modal .close { cursor:pointer; color:#555; }
    .hint { font-size:12px; color:#666; }
  </style>
</head>
<body>
<header>
  <h1>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</h1>
  <div class="user-badge" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
    ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <span id="currentUser" class="chip">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
  </div>
</header>

<!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
<div id="userOverlay" class="overlay">
  <div class="overlay-card">
    <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
    <p class="muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
    <div class="user-grid">
      <button class="user-btn" data-user="KM">KM</button>
      <button class="user-btn" data-user="TK">TK</button>
      <button class="user-btn" data-user="PSO">PSO</button>
      <button class="user-btn" data-user="PST">PST</button>
      <button class="user-btn" data-user="PK">PK</button>
      <button class="user-btn" data-user="PA">PA</button>
    </div>
    <p class="hint">* ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‚Äú‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‚Äù ‡πÑ‡∏î‡πâ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
  </div>
</div>

<!-- Modal ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Material -->
<div id="materialModal" class="modal">
  <div class="card">
    <div class="header">
      <h3 style="margin:0">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Material</h3>
      <span id="modalClose" class="close">‚úï</span>
    </div>
    <div class="row">
      <div class="col-6">
        <label>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</label>
        <input type="text" id="mat_search" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™/‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏∏‡πà‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." />
        <p class="hint">‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå: Name + A1, B1, C1, D1, H1</p>
      </div>
      <div class="col-6">
        <label>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</label>
        <div><span id="mat_count" class="chip">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></div>
      </div>
    </div>
    <table>
      <thead>
        <tr id="mat_header_row"></tr>
      </thead>
      <tbody id="mat_tbody"></tbody>
    </table>
  </div>
</div>

<div class="container">
  <!-- HOME -->
  <section id="homeSection" class="home">
    <h2>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2>
    <p class="muted">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
    <div style="margin-top:24px;">
      <button class="btn" id="goIssue" type="button">‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</button>
      <button class="btn ghost" id="goReturn" type="button">‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</button>
    </div>
  </section>

  <!-- ISSUE FORM -->
  <section id="issueSection" class="hidden">
    <div class="toolbar">
      <a class="backlink" data-back>‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
      <span class="chip">‡πÇ‡∏´‡∏°‡∏î: ‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</span>
    </div>
    <h2>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</h2>
    <p class="muted">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>

    <div class="actions">
      <button class="btn" id="openMatSearch_issue">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Material</button>
    </div>

    <div class="row">
      <div class="col-6">
        <label>‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å</label>
        <input type="text" id="issue_requester" placeholder="‡πÄ‡∏ä‡πà‡∏ô Phurilap Khonthong" />
      </div>
      <div class="col-6">
        <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏ó‡∏µ‡∏°</label>
        <input type="text" id="issue_team" placeholder="‡πÄ‡∏ä‡πà‡∏ô TH Service Team" />
      </div>
      <div class="col-6">
        <label>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å</label>
        <textarea id="issue_reason" rows="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô PM / CM / Demo / Warranty / Internal Use"></textarea>
      </div>
      <div class="col-6">
        <label>Cost Center / Project / Order (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
        <input type="text" id="issue_costCenter" />
      </div>
      <div class="col-6">
        <label>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / Serial No. (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
        <input type="text" id="issue_customer" placeholder="‡πÄ‡∏ä‡πà‡∏ô Customer ABC / SN-123456" />
      </div>
      <div class="col-6">
        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
        <input type="date" id="issue_needDate" />
      </div>
    </div>

    <div class="section">
      <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</h3>
      <div class="row">
        <div class="col-6">
          <label>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</label>
          <input type="text" id="issue_search" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™/‡∏£‡∏∏‡πà‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." />
        </div>
        <div class="col-6">
          <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</label>
          <select id="issue_select"></select>
        </div>
        <div class="col-6">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
          <input type="number" id="issue_qty" min="1" value="1" />
        </div>
        <div class="col-6">
          <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô pcs, set)</label>
          <input type="text" id="issue_uom" placeholder="‡πÄ‡∏ä‡πà‡∏ô pcs" />
        </div>
      </div>
      <div class="actions">
        <button class="btn small" id="issue_add">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
      </div>

      <table id="issue_table">
        <thead>
          <tr>
            <th>‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</th>
            <th>‡∏£‡∏∏‡πà‡∏ô/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
            <th>‡∏•‡∏ö</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="actions">
        <button class="btn" id="issue_download">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏Ç‡∏≠ (CSV)</button>
        <button class="btn" id="issue_confirm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å)</button>
        <button class="btn ghost" id="download_inventory">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï (CSV)</button>
      </div>
      <p class="footer-note">* ‚Äú‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‚Äù ‡∏à‡∏∞‡∏´‡∏±‡∏Å H ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≠‡∏î‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå I..N ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
    </div>
  </section>

  <!-- RETURN FORM -->
  <section id="returnSection" class="hidden">
    <div class="toolbar">
      <a class="backlink" data-back>‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
      <span class="chip">‡πÇ‡∏´‡∏°‡∏î: ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</span>
    </div>
    <h2>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</h2>
    <p class="muted">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö/‡∏™‡∏ï‡πá‡∏≠‡∏Å</p>

    <div class="actions">
      <button class="btn" id="openMatSearch_return">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Material</button>
    </div>

    <div class="row">
      <div class="col-6">
        <label>‡∏ú‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô</label>
        <input type="text" id="return_requester" placeholder="‡πÄ‡∏ä‡πà‡∏ô Phurilap Khonthong" />
      </div>
      <div class="col-6">
        <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏ó‡∏µ‡∏°</label>
        <input type="text" id="return_team" placeholder="‡πÄ‡∏ä‡πà‡∏ô TH Service Team" />
      </div>
      <div class="col-6">
        <label>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô</label>
        <textarea id="return_reason" rows="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß / ‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡πÄ‡∏Å‡∏¥‡∏ô / ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ / ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏∏‡πà‡∏ô"></textarea>
      </div>
      <div class="col-6">
        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</label>
        <select id="return_condition">
          <option value="New/Unused">‡πÉ‡∏´‡∏°‡πà/‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ</option>
          <option value="Used/Good">‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ / ‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏µ</option>
          <option value="Defective">‡∏ä‡∏≥‡∏£‡∏∏‡∏î</option>
          <option value="For Scrap">‡∏Ñ‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á</option>
        </select>
      </div>
      <div class="col-6">
        <label>‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
        <input type="text" id="return_ref" placeholder="‡πÄ‡∏ä‡πà‡∏ô Issue Doc No." />
      </div>
      <div class="col-6">
        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô</label>
        <input type="date" id="return_date" />
      </div>
    </div>

    <div class="section">
      <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô</h3>
      <div class="row">
        <div class="col-6">
          <label>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</label>
          <input type="text" id="return_search" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™/‡∏£‡∏∏‡πà‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." />
        </div>
        <div class="col-6">
          <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</label>
          <select id="return_select"></select>
        </div>
        <div class="col-6">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
          <input type="number" id="return_qty" min="1" value="1" />
        </div>
        <div class="col-6">
          <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô pcs, set)</label>
          <input type="text" id="return_uom" placeholder="‡πÄ‡∏ä‡πà‡∏ô pcs" />
        </div>
      </div>
      <div class="actions">
        <button class="btn small" id="return_add">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
      </div>

      <table id="return_table">
        <thead>
          <tr>
            <th>‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</th>
            <th>‡∏£‡∏∏‡πà‡∏ô/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
            <th>‡∏•‡∏ö</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="actions">
        <button class="btn" id="return_download">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô (CSV)</button>
      </div>
    </div>
  </section>
</div>

<script>
  // ===== CONFIG =====
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQg2ma13Gm9ppdtEaZAb9fLuZn2YmoXFJx3DYb5te4Fua4xej_OFU-_6J6OQBXXdO8AAWlueRQ1omHd/pub?output=csv";

  // üëâ ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ Web App URL ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏´‡∏•‡∏±‡∏á Deploy
  const APPS_SCRIPT_ENDPOINT = "https://script.google.com/macros/s/xxxxxxxxxxxx/exec";

  // ‡πÄ‡∏î‡∏≤ header ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
  const keyMap = {
    code: ["Part Number","PartNo","Code","Part Code","Material Code","Material"],
    name: ["Part Name","Description","Item Name","Name","Material Name"],
    model:["Instrument Model","Model","Machine","Category","Series"]
  };
  const NAME_HEADER_CANDIDATES = ["Part Name","Description","Item Name","Name","Material Name"];

  // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô modal
  const LETTER_COLUMNS = ["A","B","C","D","H"];

  // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‚Üí ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (I..N)
  const USER_COL_MAP = { KM: "I", TK: "J", PSO: "K", PST: "L", PK: "M", PA: "N" };

  // ===== STATE =====
  let headers = [];     // header ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å
  let rowsRaw = [];     // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  let parts = [];       // [{code,name,model,raw}]
  let currentUser = null;
  let activeForm = "issue";

  // ===== HELPERS (DOM) =====
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => document.querySelectorAll(sel);

  function showSection(id){
    $("#homeSection").classList.add("hidden");
    $("#issueSection").classList.add("hidden");
    $("#returnSection").classList.add("hidden");
    document.getElementById(id).classList.remove("hidden");
  }
  function showOverlay(v){ $("#userOverlay").style.display = v ? "flex" : "none"; }

  // ===== CSV PARSER =====
  function parseCSV(text) {
    const lines = text.replace(/\r/g, "").split("\n");
    const headersLocal = lines[0].split(",").map(h => h.trim());
    const rows = lines.slice(1).filter(l => l.trim().length>0).map(line => {
      const cols = [];
      let cur = "", inQuotes = false;
      for (let i=0;i<line.length;i++){
        const ch=line[i];
        if(ch==='\"'){
          if(inQuotes && line[i+1]==='\"'){ cur+='\"'; i++; }
          else { inQuotes=!inQuotes; }
        } else if(ch===',' && !inQuotes){ cols.push(cur); cur=""; }
        else { cur+=ch; }
      }
      cols.push(cur);
      const obj={};
      headersLocal.forEach((h,idx)=> obj[h]= (cols[idx]||"").trim().replace(/^\"|\"$/g,""));
      return obj;
    });
    return { headers: headersLocal, rows };
  }

  // ===== DATA UTIL =====
  function pick(obj, candidates){
    for(const k of candidates){ if(k in obj && obj[k] !== "") return obj[k]; }
    return "";
  }
  function toNumber(v){
    if(v===null || v===undefined) return 0;
    const n = parseFloat(String(v).replace(/,/g,'').trim());
    return isNaN(n) ? 0 : n;
  }
  function colLetterToIndex(letter){
    letter = letter.toUpperCase().trim();
    let idx = 0;
    for (let i=0; i<letter.length; i++){
      idx = idx * 26 + (letter.charCodeAt(i) - 64);
    }
    return idx - 1; // 0-based
  }
  function headerByLetter(letter){
    const idx = colLetterToIndex(letter);
    return headers[idx] || null;
  }
  function getCell(rowObj, letter){
    const h = headerByLetter(letter);
    return h ? rowObj[h] : "";
  }
  function setCell(rowObj, letter, value){
    const h = headerByLetter(letter);
    if(h){ rowObj[h] = String(value); }
  }

  // ===== LOAD DATA =====
  async function loadParts() {
    const res = await fetch(CSV_URL);
    if(!res.ok) throw new Error("‡πÇ‡∏´‡∏•‡∏î CSV ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    const text = await res.text();
    const parsed = parseCSV(text);
    headers = parsed.headers;
    rowsRaw = parsed.rows;

    parts = rowsRaw.map(r => ({
      code: pick(r, keyMap.code),
      name: pick(r, keyMap.name),
      model: pick(r, keyMap.model),
      raw: r
    })).filter(p => p.code || p.name);

    buildMaterialModalHeader();
    refreshSelect("issue_select", parts);
    refreshSelect("return_select", parts);
  }

  function refreshSelect(selectId, list) {
    const selectEl = document.getElementById(selectId);
    selectEl.innerHTML = "";
    list.forEach(p => {
      const opt = document.createElement("option");
      opt.value = p.code || p.name;
      opt.textContent = `${p.code || "-"} | ${p.name || "-"} ${p.model ? "(" + p.model + ")" : ""}`;
      selectEl.appendChild(opt);
    });
  }

  function wireSearch(searchId, selectId){
    const searchEl = document.getElementById(searchId);
    searchEl.addEventListener("input", () => {
      const q = searchEl.value.toLowerCase();
      const filtered = parts.filter(p =>
        (p.code||"").toLowerCase().includes(q) ||
        (p.name||"").toLowerCase().includes(q) ||
        (p.model||"").toLowerCase().includes(q)
      );
      refreshSelect(selectId, filtered);
    });
  }

  // ===== ISSUE/RETURN ADD LINE =====
  function addLine(tableId, selectId, qtyId, uomId){
    const selectEl = document.getElementById(selectId);
    if(selectEl.options.length === 0) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å");
    const value = selectEl.value;
    const qty = parseInt(document.getElementById(qtyId).value || "1",10);
    const uom = document.getElementById(uomId).value || "pcs";
    if (qty <= 0) return alert("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0");

    let selected = parts.find(p => p.code === value)
      || parts.find(p => (p.code || p.name) === value);

    if(!selected) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å");

    const tbody = document.querySelector(`#${tableId} tbody`);
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${selected.code || ""}</td>
      <td>${selected.name || ""}</td>
      <td>${selected.model || ""}</td>
      <td>${qty}</td>
      <td>${uom}</td>
      <td><button class="btn small ghost">‡∏•‡∏ö</button></td>
    `;
    tr.querySelector("button").addEventListener("click", ()=> tr.remove());
    tbody.appendChild(tr);
  }

  function wireAddButtons(){
    $("#issue_add").addEventListener("click", () => {
      addLine("issue_table","issue_select","issue_qty","issue_uom");
    });
    $("#return_add").addEventListener("click", () => {
      addLine("return_table","return_select","return_qty","return_uom");
    });
  }

  // ===== DOWNLOADS (‡∏Ñ‡∏≥‡∏Ç‡∏≠ & ‡∏™‡∏ï‡πá‡∏≠‡∏Å) =====
  function downloadCSV(filename, headersRow, rows){
    const csv = [headersRow, ...rows]
      .map(r => r.map(v => `"${String(v??"").replace(/"/g,'""')}"`).join(","))
      .join("\n");
    const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
  }

  function wireDownload(){
    // ISSUE request
    $("#issue_download").addEventListener("click", () => {
      const rowsOut = [];
      const tbody = $("#issue_table tbody");
      const requester = $("#issue_requester").value;
      const team = $("#issue_team").value;
      const reason = $("#issue_reason").value;
      const costCenter = $("#issue_costCenter").value;
      const customer = $("#issue_customer").value;
      const needDate = $("#issue_needDate").value;

      Array.from(tbody.children).forEach(tr => {
        const tds = Array.from(tr.children).map(td => td.textContent);
        rowsOut.push(["Issue", currentUser || "-", requester, team, reason, costCenter, customer, needDate, ...tds.slice(0,5)]);
      });

      if(rowsOut.length === 0) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á");
      downloadCSV(
        `spare_part_issue_${new Date().toISOString().slice(0,10)}.csv`,
        ["Type","User","Requester","Team","Reason","CostCenter","Customer/SN","NeedDate","PartCode","PartName","Model","Qty","UoM"],
        rowsOut
      );
    });

    // RETURN request
    $("#return_download").addEventListener("click", () => {
      const rowsOut = [];
      const tbody = $("#return_table tbody");
      const requester = $("#return_requester").value;
      const team = $("#return_team").value;
      const reason = $("#return_reason").value;
      const condition = $("#return_condition").value;
      const ref = $("#return_ref").value;
      const date = $("#return_date").value;

      Array.from(tbody.children).forEach(tr => {
        const tds = Array.from(tr.children).map(td => td.textContent);
        rowsOut.push(["Return", currentUser || "-", requester, team, reason, condition, ref, date, ...tds.slice(0,5)]);
      });

      if(rowsOut.length === 0) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á");
      downloadCSV(
        `spare_part_return_${new Date().toISOString().slice(0,10)}.csv`,
        ["Type","User","Requester","Team","Reason","Condition","Reference","ReturnDate","PartCode","PartName","Model","Qty","UoM"],
        rowsOut
      );
    });

    // Inventory (‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ)
    $("#download_inventory").addEventListener("click", () => {
      if(headers.length === 0 || rowsRaw.length === 0) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ï‡πá‡∏≠‡∏Å");
      const rowsOut = rowsRaw.map(r => headers.map(h => r[h]));
      downloadCSV(
        `inventory_updated_${new Date().toISOString().slice(0,10)}.csv`,
        headers,
        rowsOut
      );
    });
  }

  // ===== ISSUE CONFIRM: H ‡∏•‡∏î, I..N ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ + (‡∏≠‡∏≠‡∏õ‡∏ä‡∏±‡∏ô) ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Apps Script =====
  function wireIssueConfirm(){
    $("#issue_confirm").addEventListener("click", async () => {
      if(!currentUser){
        showOverlay(true);
        return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
      }
      const userColLetter = USER_COL_MAP[currentUser];
      if(!userColLetter) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏°‡∏õ‡πÑ‡∏ß‡πâ");

      const hHeader = headerByLetter("H");
      const uHeader = headerByLetter(userColLetter);
      if(!hHeader || !uHeader){
        return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏±‡∏ß‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå H ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (I..N) ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV");
      }

      const tbody = $("#issue_table tbody");
      const rowsTr = Array.from(tbody.children);
      if(rowsTr.length === 0) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á");

      const payload = []; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÑ‡∏õ Apps Script

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô
      for(const tr of rowsTr){
        const [codeCell, nameCell, modelCell, qtyCell] = Array.from(tr.children).map(td => td.textContent);
        const qty = toNumber(qtyCell);
        let item = parts.find(p => (p.code||"") === (codeCell||""));
        if(!item && nameCell){
          item = parts.find(p => (p.name||"") === (nameCell||"") && (p.model||"") === (modelCell||""));
        }
        if(!item){ return alert(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${codeCell || nameCell}`); }
        const rowObj = item.raw;
        const hVal = toNumber(getCell(rowObj, "H"));

        if (qty <= 0) { return alert(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (${codeCell || nameCell})`); }
        if (hVal < qty) { return alert(`‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏´‡∏•‡∏±‡∏Å (H) ‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${codeCell || nameCell} (‡∏°‡∏µ ${hVal}, ‡∏Ç‡∏≠ ${qty})`); }

        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° payload (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ endpoint)
        payload.push({
          code: item.code || "",         // ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™
          name: item.name || "",
          user: currentUser,
          deltaH: -qty,
          deltaUser: +qty
        });
      }

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ (in-memory)
      rowsTr.forEach(tr => {
        const [codeCell, nameCell, modelCell, qtyCell] = Array.from(tr.children).map(td => td.textContent);
        const qty = toNumber(qtyCell);
        let item = parts.find(p => (p.code||"") === (codeCell||""));
        if(!item && nameCell){
          item = parts.find(p => (p.name||"") === (nameCell||"") && (p.model||"") === (modelCell||""));
        }
        const rowObj = item.raw;
        const hVal = toNumber(getCell(rowObj, "H"));
        const uVal = toNumber(getCell(rowObj, USER_COL_MAP[currentUser]));
        setCell(rowObj, "H", (hVal - qty));
        setCell(rowObj, USER_COL_MAP[currentUser], (uVal + qty));
      });

      // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß
      $("#issue_table tbody").innerHTML = "";

      // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Apps Script endpoint ‚Üí POST ‡πÑ‡∏õ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏µ‡∏ï‡∏à‡∏£‡∏¥‡∏á
      if(APPS_SCRIPT_ENDPOINT && /^https?:\/\//i.test(APPS_SCRIPT_ENDPOINT)){
        try{
          const res = await fetch(APPS_SCRIPT_ENDPOINT, {
            method: "POST",
            mode: "cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });
          const data = await res.json().catch(()=>({}));
          if(res.ok && data && data.ok){
            alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö + Google Sheet)");
          }else{
            alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏™‡πà‡∏á‡πÑ‡∏õ Google Sheet ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          }
        }catch(err){
          console.error(err);
          alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Apps Script ‡πÑ‡∏î‡πâ");
        }
      }else{
        alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheet)");
      }
    });
  }

  // ===== MATERIAL SEARCH MODAL =====
  const modal = $("#materialModal");
  const modalClose = $("#modalClose");
  const matSearchInput = $("#mat_search");
  const matTbody = $("#mat_tbody");
  const matHeaderRow = $("#mat_header_row");
  const matCount = $("#mat_count");

  function buildMaterialModalHeader(){
    matHeaderRow.innerHTML = "";
    // Name
    const thName = document.createElement("th"); thName.textContent = "Name"; matHeaderRow.appendChild(thName);
    // A/B/C/D/H
    LETTER_COLUMNS.forEach(l => {
      const idx = colLetterToIndex(l);
      const th = document.createElement("th");
      th.textContent = headers[idx] || `${l}1`;
      matHeaderRow.appendChild(th);
    });
    const thPick = document.createElement("th"); thPick.textContent = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"; matHeaderRow.appendChild(thPick);
  }
  function getNameFromRow(rowObj){
    const fromCandidates = pick(rowObj, NAME_HEADER_CANDIDATES);
    return fromCandidates || pick(rowObj, keyMap.name) || "";
