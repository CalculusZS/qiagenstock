<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select User</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body onload="initUserPage()" style="background:#f8fafc;">
    <div class="header" style="background:#1e293b; color:white; padding:15px; text-align:center; font-weight:bold; font-size:18px;">
        üë§ SELECT USER
    </div>

    <div class="container" style="max-width:500px; margin:20px auto; padding:0 15px;">
        <p style="color:#64748b; font-size:14px; text-align:center; margin-bottom:20px;">Please select your name before proceeding:</p>
        
        <div id="userGrid" style="display:grid; gap:10px; margin-bottom:30px;">
            <p style="text-align:center; color:#94a3b8;">Loading names...</p>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <button onclick="navigate('withdraw.html')" style="background:#ef4444; color:white; border:none; padding:15px; border-radius:12px; font-weight:bold; cursor:pointer;">WITHDRAW</button>
            <button onclick="navigate('return.html')" style="background:#22c55e; color:white; border:none; padding:15px; border-radius:12px; font-weight:bold; cursor:pointer;">RETURN</button>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        async function initUserPage() {
            const grid = document.getElementById('userGrid');
            const users = await window.loadUsers();
            
            if (users.length === 0) {
                grid.innerHTML = "Error loading users.";
                return;
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô String ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô [object Object]
            grid.innerHTML = users.map(name => {
                const displayName = typeof name === 'object' ? (name.name || name.User) : name;
                return `<button class="user-btn" onclick="selectUser(this, '${displayName}')" 
                        style="padding:15px; background:white; border:2px solid #e2e8f0; border-radius:12px; font-weight:600; color:#1e293b; text-align:left; cursor:pointer; transition:0.2s;">
                        ${displayName}
                        </button>`;
            }).join('');
        }

        function selectUser(btn, name) {
            document.querySelectorAll('.user-btn').forEach(b => {
                b.style.borderColor = '#e2e8f0';
                b.style.background = 'white';
            });
            btn.style.borderColor = '#2563eb';
            btn.style.background = '#eff6ff';
            sessionStorage.setItem('selectedUser', name);
        }

        function navigate(path) {
            if (!sessionStorage.getItem('selectedUser')) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô!");
            location.href = path;
        }
    </script>
</body>
</html>
