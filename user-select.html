<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select User</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì */
        body { background: #f8fafc; font-family: sans-serif; margin: 0; }
        .header { background: #1e293b; color: white; padding: 20px; text-align: center; font-weight: bold; font-size: 1.2rem; }
        .container { max-width: 500px; margin: 20px auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        #userGrid { display: grid; gap: 12px; margin-bottom: 25px; }
        .user-btn { 
            padding: 15px; background: white; border: 2px solid #e2e8f0; border-radius: 12px; 
            text-align: center; font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .user-btn:hover { border-color: #2563eb; background: #f1f5f9; }
        .active { border-color: #2563eb; background: #eff6ff; color: #2563eb; }
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-main { padding: 15px; border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; font-size: 14px; }
    </style>
</head>
<body onload="initUserPage()">
    <div class="header">üë§ SELECT USER</div>
    
    <div class="container">
        <p style="text-align:center; color:#64748b; margin-top:0;">Please select your name before proceeding:</p>
        
        <div id="userGrid">
            <p style="text-align:center; padding:20px;">Loading names...</p>
        </div>

        <div class="action-grid">
            <button onclick="navigate('withdraw.html')" class="btn-main" style="background:#ef4444;">WITHDRAW</button>
            <button onclick="navigate('return.html')" class="btn-main" style="background:#22c55e;">RETURN</button>
            <button onclick="location.href='show-all.html'" class="btn-main" style="background:#94a3b8;">SHOW ALL</button>
            <button onclick="checkSupervisor()" class="btn-main" style="background:#2563eb;">SUPERVISOR</button>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        async function initUserPage() {
            const grid = document.getElementById('userGrid');
            try {
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏≤‡∏Å app.js
                const users = await window.loadUsers();
                
                if (!users || users.length === 0) {
                    grid.innerHTML = '<p style="color:red; text-align:center;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</p>';
                    return;
                }

                grid.innerHTML = users.map(u => {
                    // ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ [object Object] ‡∏´‡∏£‡∏∑‡∏≠ undefined
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ u ‡πÄ‡∏õ‡πá‡∏ô Object ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ name ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
                    let userName = "";
                    if (typeof u === 'object' && u !== null) {
                        userName = u.name || Object.values(u)[0];
                    } else {
                        userName = u;
                    }

                    if (!userName) return ""; // ‡∏Ç‡πâ‡∏≤‡∏°‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠

                    return `
                        <button class="user-btn" onclick="selectUser(this, '${userName}')">
                            ${userName}
                        </button>
                    `;
                }).join('');

            } catch (err) {
                grid.innerHTML = '<p style="color:red; text-align:center;">Error loading data</p>';
                console.error(err);
            }
        }

        function selectUser(btn, name) {
            // ‡∏•‡∏ö class active ‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏∑‡πà‡∏ô
            document.querySelectorAll('.user-btn').forEach(b => b.classList.remove('active'));
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° class active ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏î
            btn.classList.add('active');
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏á Session
            sessionStorage.setItem('selectedUser', name);
        }

        function navigate(path) {
            const selected = sessionStorage.getItem('selectedUser');
            if (!selected) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô!");
                return;
            }
            location.href = path;
        }
    </script>
</body>
</html>
