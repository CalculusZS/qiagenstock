<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction History - View Only</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; margin: 0; padding: 0; }
        .header { background-color: #003366; color: white; padding: 15px; text-align: center; position: sticky; top: 0; display: flex; align-items: center; justify-content: space-between; }
        .container { padding: 15px; max-width: 800px; margin: auto; }
        .btn-back { background: #64748b; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; }
        .card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 5px solid #003366; }
        .log-date { color: #666; font-size: 0.85em; display: block; margin-bottom: 5px; }
        .log-details { font-size: 1.1em; margin: 5px 0; }
        .log-info { color: #444; font-size: 0.9em; }
        .type-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8em; text-transform: uppercase; margin-top: 5px; }
        .WITHDRAW { background: #fee2e2; color: #b91c1c; }
        .RETURN { background: #dcfce7; color: #15803d; }
        .TRANSFER { background: #fef9c3; color: #854d0e; }
        .loading { text-align: center; padding: 50px; color: #666; }
    </style>
</head>
<body onload="loadHistory()">

    <div class="header">
        <button class="btn-back" onclick="window.history.back()">‚óÄ Back</button>
        <strong style="font-size: 1.2em;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</strong>
        <div style="width: 60px;"></div>
    </div>

    <div class="container" id="list">
        <div class="loading">‚åõ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö...</div>
    </div>

    <script>
        // ‡πÉ‡∏ä‡πâ URL ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
        const API_URL = "https://script.google.com/macros/s/AKfycbzBDmcC07-2UEIYq7XmpALt9zqcBzrkOU5hDb0BdeXTi5_VK_T2ERR1H_g7AXVpdCZw/exec";
        const PASS = "Service";

        async function loadHistory() {
            const listDiv = document.getElementById('list');
            try {
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å action=gethistory ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á password ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
                const response = await fetch(`${API_URL}?action=gethistory&password=${PASS}&t=${Date.now()}`);
                const res = await response.json();

                if (!res.success) {
                    listDiv.innerHTML = `<div class="card" style="border-left-color:red;">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ${res.msg}</div>`;
                    return;
                }

                if (!res.data || res.data.length === 0) {
                    listDiv.innerHTML = `<div class="card">üì≠ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</div>`;
                    return;
                }

                // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÇ‡∏ä‡∏ß‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                listDiv.innerHTML = res.data.map(item => {
                    const typeClass = item['Transaction Type'] || '';
                    return `
                        <div class="card">
                            <span class="log-date">üìÖ ${item['Date and Time'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'}</span>
                            <div class="log-details">
                                <strong>${item['Material'] || '-'}</strong> : ${item['Product Name'] || '-'}
                            </div>
                            <div class="log-info">
                                üë§ ‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: <b>${item['User'] || '-'}</b> | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: <b>${item['Qty'] || 0}</b>
                            </div>
                            <span class="type-tag ${typeClass}">${item['Transaction Type'] || 'N/A'}</span>
                        </div>
                    `;
                }).join('');

            } catch (err) {
                console.error(err);
                listDiv.innerHTML = `<div class="card" style="border-left-color:red;">‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets</div>`;
            }
        }
    </script>
</body>
</html>
