<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .card-log { background:white; padding:15px; border-radius:10px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); border-left: 5px solid #003366; }
        .WITHDRAW { color: #b91c1c; font-weight: bold; }
        .RETURN { color: #15803d; font-weight: bold; }
    </style>
</head>
<body onload="loadHistory()">
    <div class="header" style="background:#003366; color:white; padding:15px; display:flex; align-items:center;">
        <button onclick="window.history.back()" style="background:none; border:none; color:white; cursor:pointer;">‚óÄ Back</button>
        <b style="margin-left:15px;">Transaction History</b>
    </div>

    <div class="container" id="list" style="padding:15px;">
        <p align="center">‚åõ Loading History...</p>
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycbzBDmcC07-2UEIYq7XmpALt9zqcBzrkOU5hDb0BdeXTi5_VK_T2ERR1H_g7AXVpdCZw/exec";
        const PASS = "Service";

        async function loadHistory() {
            const listDiv = document.getElementById('list');
            try {
                const response = await fetch(`${API}?action=gethistory&password=${PASS}&t=${Date.now()}`);
                const res = await response.json();
                if (!res.success) { listDiv.innerHTML = "Error: " + res.msg; return; }

                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å‡πÉ‡∏´‡∏ç‡πà (Case-insensitive)
                const getVal = (obj, key) => {
                    const found = Object.keys(obj).find(k => k.trim().toLowerCase() === key.toLowerCase());
                    return found ? obj[found] : "-";
                };

                listDiv.innerHTML = res.data.map(item => `
                    <div class="card-log">
                        <small style="color:gray;">üìÖ ${getVal(item, 'Date and Time')}</small><br>
                        <strong>${getVal(item, 'Material')}</strong> - ${getVal(item, 'Product Name')}<br>
                        <span>Qty: <b>${getVal(item, 'Qty')}</b> | User: ${getVal(item, 'User')}</span><br>
                        <span class="${getVal(item, 'Transaction Type').toUpperCase()}">${getVal(item, 'Transaction Type')}</span>
                    </div>
                `).join('');
            } catch (err) { listDiv.innerHTML = "‚ö†Ô∏è API Connection Error"; }
        }
    </script>
</body>
</html>
