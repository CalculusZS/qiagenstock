<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxdUDS2xiQuijTCLkAOcvR5X1SzG3WH4nbKfjsC687rW4seMdIDqr7_9KWDXp8G5e0p7g/exec";
    const PASS = "Service";

    async function loadHistory() {
        const listDiv = document.getElementById('list'); // เปลี่ยน ID ให้ตรงกับใน HTML ของคุณ
        try {
            // เพิ่ม t=${Date.now()} เพื่อป้องกัน Cache
            const response = await fetch(`${API_URL}?action=gethistory&password=${PASS}&t=${Date.now()}`);
            const res = await response.json();

            if (!res.success) {
                listDiv.innerHTML = `<p style="color:red">Error: ${res.msg}</p>`;
                return;
            }

            if (res.data.length === 0) {
                listDiv.innerHTML = "No history records found.";
                return;
            }

            // แสดงผลข้อมูล (ปรับแต่ง CSS ตามชอบ)
            listDiv.innerHTML = res.data.map(item => `
                <div class="card">
                    <small>${item['Date and Time']}</small><br>
                    <strong>${item['Material']}</strong> - ${item['Product Name']}<br>
                    <span>Qty: ${item['Qty']} | User: ${item['User']}</span><br>
                    <em style="color:blue">${item['Transaction Type']}</em>
                </div>
                <hr>
            `).join('');

        } catch (err) {
            console.error("CORS Error:", err);
            listDiv.innerHTML = "API Connection Error. Please check if the URL is correct and deployed as 'Anyone'.";
        }
    }
    loadHistory();
</script>
