<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Events - QIAGEN</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .history-card { 
            background: white; border-radius: 12px; padding: 16px; 
            margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex; align-items: center; gap: 15px;
            border-left: 6px solid #cbd5e1;
        }
        /* ‡πÅ‡∏¢‡∏Å‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Action */
        .type-withdraw { border-left-color: #ef4444; } /* ‡πÅ‡∏î‡∏á: ‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏≠‡∏Å */
        .type-return { border-left-color: #22c55e; }   /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß: ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡∏≠‡∏á */
        .type-add { border-left-color: #3b82f6; }      /* ‡∏ü‡πâ‡∏≤: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å */
        .type-deduct { border-left-color: #f59e0b; }   /* ‡∏™‡πâ‡∏°: ‡∏ï‡∏±‡∏î‡πÉ‡∏ä‡πâ‡πÑ‡∏õ */

        .info-main { flex-grow: 1; }
        .time-label { font-size: 11px; color: #94a3b8; font-weight: 500; }
        .user-name { font-weight: bold; color: #1e293b; font-size: 14px; margin: 2px 0; }
        .product-detail { font-size: 12px; color: #64748b; line-height: 1.4; }
        .qty-badge { 
            background: #f1f5f9; color: #0f172a; 
            width: 35px; height: 35px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 14px; border: 1px solid #e2e8f0;
        }
    </style>
</head>
<body onload="loadHistory()">
    <div class="container">
        <div style="display:flex; align-items:center; gap:15px; margin-bottom:20px;">
            <button onclick="location.href='user-select.html'" class="btn-sm" style="background:#fff; border:1px solid #ddd;">‚óÄ Back</button>
            <h2 style="margin:0; color:#003366; font-size: 20px;">History Events</h2>
        </div>

        <div id="history-container">
            <div style="text-align:center; padding:50px; color:#94a3b8;">‚åõ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥...</div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        async function loadHistory() {
            const container = document.getElementById('history-container');
            try {
                const response = await fetch(`${API}?action=getHistory&password=${PASSWORD}`);
                const res = await response.json();
                
                if (res.success && res.data.length > 0) {
                    container.innerHTML = res.data.map(item => {
                        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Class ‡πÅ‡∏•‡∏∞ Label ‡∏ï‡∏≤‡∏° Transaction Type
                        let typeClass = '';
                        let actionLabel = item['Transaction Type'];
                        const type = String(actionLabel).toUpperCase();

                        if (type.includes('WITHDRAW')) typeClass = 'type-withdraw';
                        else if (type.includes('RETURN')) typeClass = 'type-return';
                        else if (type.includes('ADD')) typeClass = 'type-add';
                        else if (type.includes('DEDUCT')) typeClass = 'type-deduct';

                        // ‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏á‡πà‡∏≤‡∏¢
                        const dateObj = new Date(item['Date and Time']);
                        const timeStr = dateObj.toLocaleDateString('th-TH', { 
                            day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' 
                        });

                        return `
                            <div class="history-card ${typeClass}">
                                <div class="info-main">
                                    <div class="time-label">${timeStr}</div>
                                    <div class="user-name">üë§ ${item.User} ‚Ä¢ <span style="font-weight:500; color:#2563eb;">${actionLabel}</span></div>
                                    <div class="product-detail">
                                        <b>${item.Material}</b>: ${item['Product Name']}
                                    </div>
                                </div>
                                <div class="qty-badge">${item.Qty}</div>
                            </div>
                        `;
                    }).join('');
                } else {
                    container.innerHTML = '<div style="text-align:center; padding:50px; color:#94a3b8;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>';
                }
            } catch (e) {
                container.innerHTML = '<div style="text-align:center; padding:50px; color:#ef4444;">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</div>';
            }
        }
    </script>
</body>
</html>
