<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Qiagen Stock</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body onload="initMain()">
    <div style="background:#1e293b; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center;">
        <div style="font-weight:bold;">Qiagen Stock</div>
        <button onclick="logout()" style="background:#ef4444; border:none; color:white; padding:6px 12px; border-radius:6px; cursor:pointer;">Logout</button>
    </div>
    <div class="container" style="max-width:900px; margin:20px auto; padding:0 15px;">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px; background:white; padding:12px; border-radius:10px; box-shadow:0 1px 3px rgba(0,0,0,0.1);">
            <div>User: <strong id="user_display"></strong></div>
            <button onclick="goBack()" style="background:none; border:1px solid #ddd; padding:4px 8px; border-radius:5px; cursor:pointer; font-size:12px;">Change User</button>
        </div>
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <button id="t-withdraw" style="flex:1; padding:12px; border:none; border-radius:8px; cursor:pointer; font-weight:bold;" onclick="setMode('withdraw')">Withdraw</button>
            <button id="t-return" style="flex:1; padding:12px; border:none; border-radius:8px; cursor:pointer; font-weight:bold;" onclick="setMode('return')">Return</button>
        </div>
        <input type="text" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; margin-bottom:15px; box-sizing:border-box;" placeholder="Search..." oninput="window.searchStock(this.value, currentMode)">
        <div style="background:white; border-radius:10px; overflow:hidden; box-shadow:0 1px 3px rgba(0,0,0,0.1);">
            <table style="width:100%; border-collapse:collapse;">
                <thead style="background:#f8fafc;">
                    <tr><th style="text-align:left; padding:12px;">Item Information</th><th style="text-align:center;">Qty</th><th style="text-align:right;">Action</th></tr>
                </thead>
                <tbody id="data"></tbody>
            </table>
        </div>
    </div>
    <script src="js/app.js"></script>
    <script>
        let currentMode = 'withdraw';
        function initMain() {
            const u = sessionStorage.getItem('selectedUser');
            if(!u) { location.href='user-select.html'; return; }
            document.getElementById('user_display').textContent = u;
            setMode('withdraw');
        }
        function setMode(m) {
            currentMode = m;
            document.getElementById('t-withdraw').style.background = (m==='withdraw'?'#2563eb':'#e2e8f0');
            document.getElementById('t-withdraw').style.color = (m==='withdraw'?'white':'#000');
            document.getElementById('t-return').style.background = (m==='return'?'#22c55e':'#e2e8f0');
            document.getElementById('t-return').style.color = (m==='return'?'white':'#000');
            window.loadStockData(m);
        }
    </script>
    <script src="js/app.js"></script>
<script>
    let currentMode = 'withdraw';
    async function initMain() {
        const u = sessionStorage.getItem('selectedUser');
        if(!u) { location.href='user-select.html'; return; }
        document.getElementById('user_display').textContent = u;
        
        // สำคัญ: ต้องใช้ await เพื่อรอโหลดข้อมูล
        await setMode('withdraw');
    }
    
    async function setMode(m) {
        currentMode = m;
        const btnW = document.getElementById('t-withdraw');
        const btnR = document.getElementById('t-return');
        if(btnW) btnW.style.background = (m==='withdraw'?'#2563eb':'#cbd5e1');
        if(btnR) btnR.style.background = (m==='return'?'#22c55e':'#cbd5e1');
        
        await window.loadStockData(m); // โหลดข้อมูลสต็อกตามโหมด
    }
</script>
    <script src="js/app.js"></script>

<script>
    let currentMode = 'withdraw';

    async function initMain() {
        const u = sessionStorage.getItem('selectedUser');
        if(!u) { location.href='user-select.html'; return; }
        document.getElementById('user_display').textContent = u;
        
        // รอให้โหลดข้อมูลเบื้องต้นเสร็จ
        await setMode('withdraw');
    }
    
    async function setMode(m) {
        currentMode = m;
        // เปลี่ยนสีปุ่มเมนู
        const btnW = document.getElementById('t-withdraw');
        const btnR = document.getElementById('t-return');
        if(btnW) {
            btnW.style.background = (m==='withdraw'?'#2563eb':'#e2e8f0');
            btnW.style.color = (m==='withdraw'?'white':'#000');
        }
        if(btnR) {
            btnR.style.background = (m==='return'?'#22c55e':'#e2e8f0');
            btnR.style.color = (m==='return'?'white':'#000');
        }
        
        // เรียกโหลดข้อมูลจาก Google Sheets (ต้องมี await)
        await window.loadStockData(m);
    }
</script>
</body>
</html>
